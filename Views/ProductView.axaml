<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:viewModels="clr-namespace:MSM.ViewModels"
             mc:Ignorable="d" d:DesignWidth="380" d:DesignHeight="180"
             x:Class="MSM.Views.ProductView"
             x:DataType="viewModels:ProductViewModel">

    <!-- Status-based styles for the card -->
    <UserControl.Styles>
        <!-- Alert state - low stock (red background) -->
        <Style Selector="Border.product-card.alert">
            <Setter Property="Background" Value="#FFFEE2E2"/>
            <Setter Property="BorderBrush" Value="#FFFCA5A5"/>
            <Setter Property="BorderThickness" Value="2"/>
        </Style>
        <!-- Warning state (orange/yellow background) -->
        <Style Selector="Border.product-card.warning">
            <Setter Property="Background" Value="#FFFEF3C7"/>
            <Setter Property="BorderBrush" Value="#FFFCD34D"/>
            <Setter Property="BorderThickness" Value="2"/>
        </Style>
        <!-- Safe state (green background) -->
        <Style Selector="Border.product-card.safe">
            <Setter Property="Background" Value="#FFD1FAE5"/>
            <Setter Property="BorderBrush" Value="#FF6EE7B7"/>
            <Setter Property="BorderThickness" Value="2"/>
        </Style>

        <!-- Status badge styles -->
        <Style Selector="Border.status-badge.alert">
            <Setter Property="Background" Value="{DynamicResource SemiRed1Color}"/>
        </Style>
        <Style Selector="TextBlock.status-text.alert">
            <Setter Property="Foreground" Value="{DynamicResource SemiRed6Color}"/>
        </Style>
        <Style Selector="Border.status-badge.warning">
            <Setter Property="Background" Value="{DynamicResource SemiOrange1Color}"/>
        </Style>
        <Style Selector="TextBlock.status-text.warning">
            <Setter Property="Foreground" Value="{DynamicResource SemiOrange6Color}"/>
        </Style>
        <Style Selector="Border.status-badge.safe">
            <Setter Property="Background" Value="{DynamicResource SemiGreen1Color}"/>
        </Style>
        <Style Selector="TextBlock.status-text.safe">
            <Setter Property="Foreground" Value="{DynamicResource SemiGreen6Color}"/>
        </Style>
    </UserControl.Styles>

    <!-- Product Card -->
    <Border Classes="product-card"
            Classes.alert="{Binding IsAlert}"
            Classes.warning="{Binding IsWarning}"
            Classes.safe="{Binding IsSafe}"
            CornerRadius="8"
            Margin="8"
            Padding="12"
            BoxShadow="0 1 4 0 #10000000"
            Width="360"
            Height="160">

        <Grid ColumnDefinitions="120,*">
            <!-- Product Image -->
            <Border Grid.Column="0"
                    Background="{DynamicResource SemiGrey2Color}"
                    CornerRadius="6"
                    ClipToBounds="True"
                    Width="100"
                    Height="100">
                <Image Source="{Binding ProductImage}"
                       Stretch="UniformToFill"/>
            </Border>

            <!-- Product Info -->
            <Grid Grid.Column="1" Margin="12,0,0,0" RowDefinitions="Auto,*,Auto">
                <!-- Header with Name, Barcode and Status Badge -->
                <Grid Grid.Row="0" ColumnDefinitions="*,Auto">
                    <StackPanel Grid.Column="0" Spacing="2">
                        <TextBlock Text="{Binding Name}"
                                   FontWeight="SemiBold"
                                   FontSize="16"
                                   TextWrapping="NoWrap"
                                   TextTrimming="CharacterEllipsis"/>
                        <TextBlock Text="{Binding Barcode}"
                                   FontSize="12"
                                   Foreground="{DynamicResource SemiGrey5Color}"
                                   FontFamily="Consolas, Monaco, monospace"/>
                    </StackPanel>

                    <!-- Status Badge -->
                    <Border Grid.Column="1"
                            Classes="status-badge"
                            Classes.alert="{Binding IsAlert}"
                            Classes.warning="{Binding IsWarning}"
                            Classes.safe="{Binding IsSafe}"
                            CornerRadius="4"
                            Padding="6,2"
                            VerticalAlignment="Top"
                            Margin="4,0,0,0">
                        <TextBlock Classes="status-text"
                                   Classes.alert="{Binding IsAlert}"
                                   Classes.warning="{Binding IsWarning}"
                                   Classes.safe="{Binding IsSafe}"
                                   FontSize="10"
                                   FontWeight="Medium">
                            <TextBlock.Text>
                                <MultiBinding StringFormat="{}{0}">
                                    <Binding Path="IsAlert" />
                                </MultiBinding>
                            </TextBlock.Text>
                        </TextBlock>
                    </Border>
                </Grid>

                <!-- Quantity Display -->
                <StackPanel Grid.Row="1" VerticalAlignment="Center" Spacing="4">
                    <TextBlock Text="재고 수량"
                               FontSize="13"
                               Foreground="{DynamicResource SemiGrey6Color}"/>
                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <TextBlock Text="{Binding Quantity}"
                                   FontWeight="Bold"
                                   FontSize="28"/>
                        <TextBlock Text="개"
                                   FontSize="14"
                                   VerticalAlignment="Bottom"
                                   Margin="0,0,0,5"
                                   Foreground="{DynamicResource SemiGrey6Color}"/>
                    </StackPanel>
                </StackPanel>

                <!-- Action Buttons -->
                <StackPanel Grid.Row="2"
                            Orientation="Horizontal"
                            HorizontalAlignment="Right"
                            Spacing="8">
                    <Button x:Name="EditButton"
                            Content="수정"
                            Command="{Binding EditCommand}"
                            CommandParameter="{Binding .}"
                            Padding="14,6"
                            FontSize="14"/>
                    <Button x:Name="DeleteButton"
                            Content="삭제"
                            Command="{Binding DeleteCommand}"
                            CommandParameter="{Binding .}"
                            Classes="Danger"
                            Padding="14,6"
                            FontSize="14"/>
                </StackPanel>
            </Grid>
        </Grid>
    </Border>
</UserControl>
